<UserControl x:Class="ReplaysApp.Views.ReplaysView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:ReplaysApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="500" d:DesignWidth="900">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:TimeSpanToSecondsConverter x:Key="TimeSpanConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="15" Background="{StaticResource PrimaryBackgroundColor}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Margin="0,0,15,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                <Grid>
                    <MediaElement x:Name="MediaPlayer" 
                                  Source="{Binding PlaybackSource}" 
                                  LoadedBehavior="Manual" 
                                  UnloadedBehavior="Stop"
                                  MediaOpened="MediaPlayer_OnMediaOpened" 
                                  MediaEnded="MediaPlayer_OnMediaEnded"
                                  Visibility="{Binding IsPlaybackVisible, Converter={StaticResource BoolToVis}}"/>
                    <Image Source="{Binding ImagemDaCamera}" 
                           Visibility="{Binding IsCameraVisible, Converter={StaticResource BoolToVis}}"/>
                </Grid>
            </Border>

            <StackPanel Grid.Row="1" Margin="0,10,0,0"
                        Visibility="{Binding IsPlaybackVisible, Converter={StaticResource BoolToVis}}">
                <Slider x:Name="ProgressSlider"
                        IsMoveToPointEnabled="True"
                        Maximum="{Binding PlaybackDuration.TotalSeconds}"
                        Value="{Binding PlaybackProgress, Mode=TwoWay, Converter={StaticResource TimeSpanConverter}}"
                        Thumb.DragStarted="Slider_DragStarted"
                        Thumb.DragCompleted="Slider_DragCompleted"
                        PreviewMouseLeftButtonUp="Slider_PreviewMouseLeftButtonUp"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                    <Button Content="{Binding PlayPauseButtonContent}" Command="{Binding PlayPauseCommand}" MinWidth="80" FontWeight="Bold"/>
                    <Button Content="Voltar para Câmera" Command="{Binding VoltarParaCameraCommand}" MinWidth="80" Margin="10,0,0,0"/>
                </StackPanel>
            </StackPanel>

            <Button Grid.Row="2" Content="Salvar Replay" Click="SalvarReplayBotao_Click" Margin="0,10,0,0" Padding="10,8" FontSize="14" FontWeight="Bold"/>
        </Grid>

        <DockPanel Grid.Column="1">
            <Button Content="Sair" Command="{Binding LogoutCommand}" DockPanel.Dock="Top" HorizontalAlignment="Stretch" Margin="0,0,0,10" Padding="10,8" FontWeight="Bold"/>
            <GroupBox Header="Replays Salvos" Foreground="{StaticResource PrimaryForegroundColor}" BorderBrush="{StaticResource BorderColor}">
                <ListBox ItemsSource="{Binding Replays}" HorizontalContentAlignment="Stretch" SelectedItem="{Binding ReplaySelecionado, Mode=TwoWay}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <Border Grid.Column="0" Width="100" Height="56" CornerRadius="3" Margin="0,0,10,0" Background="#333338">
                                    <Image Source="{Binding CaminhoThumbnail}" Stretch="UniformToFill"/>
                                </Border>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Nome}" FontWeight="Bold" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding DataGravacao, StringFormat='dd/MM/yyyy HH:mm'}" FontSize="11" Foreground="Gray" Margin="0,2,0,0"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <Button Content="Renomear" Margin="0,0,5,0" Padding="8,4"
                                                Command="{Binding DataContext.RenomearReplayCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="Download" Padding="8,4" Margin="0,0,5,0"
                                                Command="{Binding DataContext.CopiarReplayCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="Excluir" Padding="8,4" 
                                                Command="{Binding DataContext.ExcluirReplayCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </GroupBox>
        </DockPanel>
    </Grid>
</UserControl>